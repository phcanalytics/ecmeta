<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meta-analytic framework • ecmeta</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Meta-analytic framework">
<meta property="og:description" content="ecmeta">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ecmeta</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">API</a>
</li>
<li>
  <a href="../articles/methodology.html">Methodology</a>
</li>
<li>
  <a href="../articles/simulations.html">Simulations</a>
</li>
<li>
  <a href="../articles/guide.html">User guide</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.roche.com/RWDScodeshare/ecmeta">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="methodology_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Meta-analytic framework</h1>
            
            <h4 class="date">2021-06-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.roche.com/RWDScodeshare/ecmeta/blob/master/vignettes/methodology.Rmd"><code>vignettes/methodology.Rmd</code></a></small>
      <div class="hidden name"><code>methodology.Rmd</code></div>

    </div>

    
    
<div id="problem" class="section level1">
<h1 class="hasAnchor">
<a href="#problem" class="anchor"></a>Problem</h1>
<p>We consider a new single-arm study with two arms:</p>
<ul>
<li>TRT: the novel treatment arm</li>
<li>EC: the external control arm</li>
</ul>
<p>In a typical analysis, we use this study to estimate the log hazard ratio of the novel treatment arm relative to the external control, <span class="math inline">\(\hat\lambda_{TRTvEC}^{new}\)</span>. However, the non-randomized design may result in additional bias and variability. It what follows, we describe a meta-analytic approach that uses historical (i.e., reference) studies to incorporate this additional bias and variability.</p>
</div>
<div id="hazard-ratio-adjustment" class="section level1">
<h1 class="hasAnchor">
<a href="#hazard-ratio-adjustment" class="anchor"></a>Hazard ratio adjustment</h1>
<p>In a randomized clinical trial, we estimate the treatment effect in an unbiased manner by comparing the novel treatment arm to an internal control arm. Since there is no internal control arm in a single-arm trial, we adjust the hazard ratio from the single-arm study to obtain a hazard ratio that we would have obtained had an internal control existed. Specifically, letting <span class="math inline">\(\lambda\)</span> denote the true log hazard ratio of a treatment comparison (i.e., if we could observe the outcome in an infinite sized population), we have,</p>
<p><span class="math display">\[
\lambda_{TRTvIC}^{new} =  \lambda_{TRTvEC}^{new} - \lambda_{ICvEC}^{new}. 
\]</span></p>
<p>Under the assumption of proportional hazards, this relationship holds exactly for the true underlying hazard ratios. Note that with observed hazard ratios, due to the nature of hazard ratios being estimated from non-linear optimization, the corresponding relationship is an approximation with a small error attached to it.</p>
<p>We cannot estimate of <span class="math inline">\(\lambda_{ICvEC}^{new}\)</span> in a single-arm study, but we can predict its probability distribution using a set of reference studies.</p>
</div>
<div id="meta-analytic-model" class="section level1">
<h1 class="hasAnchor">
<a href="#meta-analytic-model" class="anchor"></a>Meta-analytic model</h1>
<p>We consider <span class="math inline">\(n\)</span> reference studies and a model for the treatment, external control, and internal control arms. As shown in the <a href="#dags">Appendix</a>, outcomes among the reference studies for the treatment arm are irrelevant and model estimation can focus solely on comparisons of the external and internal controls. That is, we model estimates of the hazard ratio of the internal control relative to the external control as,</p>
<p><span class="math display">\[
\hat\lambda_{ICvEC,j} \sim N (\lambda_{ICvEC,j}, V_j),
\]</span></p>
<p>where <span class="math inline">\(j\)</span> indexes a study and <span class="math inline">\(V_j\)</span> is the sampling variance. We assume that the true log hazard ratio is distributed with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span>,</p>
<p><span class="math display">\[
\lambda_{ICvEC,j} \sim N ( \mu , \sigma^2),
\]</span> so that <span class="math inline">\(\mu\)</span> is a measure of the average bias in the external control arms across studies and <span class="math inline">\(\sigma^2\)</span> is a measure of between study variability. It follows that the estimated log hazard ratio is distributed as,</p>
<p><span class="math display">\[
\hat\lambda_{ICvEC,j} \sim N ( \mu , \sigma^2 + V_j).
\]</span></p>
<div id="estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#estimation" class="anchor"></a>Estimation</h2>
<p>Our primary estimation methodology uses Bayesian techniques to estimate <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, with priors given by,</p>
<p><span class="math display">\[
\mu \sim N(0, A) \\
1/\sigma^2 \sim \rm{Gamma}(a, b),
\]</span> By default, we set <span class="math inline">\(A = 1/0.0001\)</span> so that the prior for <span class="math inline">\(\mu\)</span> is relatively uninformative. Similarly, <span class="math inline">\(a = 0.001\)</span> and <span class="math inline">\(b = 0.001\)</span> by default, implying that the precision, <span class="math inline">\(1/\sigma^2\)</span>, has a prior mean of <span class="math inline">\(a/b=1\)</span> and variance of <span class="math inline">\(a/b^2 = 1000\)</span>. Markov Chain Monte Carlo (MCMC) sampling is performed using the JAGS software and implemented in the function <code><a href="../reference/ecmeta.html">ecmeta()</a></code>.</p>
<p>The <a href="#ml">Appendix</a> details an alternative non-Bayesian approach based on maximum likelihood. This technique can be helpful when running Monte Carlo simulations and there is a need for a faster implementation or to assess the influence of the priors.</p>
</div>
<div id="prediction-for-new-study" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction-for-new-study" class="anchor"></a>Prediction for new study</h2>
<p>For the new single-arm study, we first estimate the log hazard ratio, <span class="math inline">\(\hat{\lambda}_{TRTvEC}^{new}\)</span>, and its variance <span class="math inline">\(V^{new}\)</span> (e.g., using propensity score techniques). We can then obtain the sampling distribution for <span class="math inline">\(\lambda_{TRTvEC}^{new}\)</span> with the model,</p>
<p><span class="math display">\[
\lambda_{TRTvEC}^{new} \sim N(0, A), \\
\hat{\lambda}_{TRTvEC}^{new} ~ N(\lambda_{TRTvEC}^{new}, V^{new}),
\]</span> and, by default, using a diffuse prior with <span class="math inline">\(A = 1/0.0001\)</span>. Sampling is again implemented using the JAGS software.</p>
<p>We then sample <span class="math inline">\(\lambda_{ECvIC}^{new}\)</span> using posterior draws of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> as,</p>
<p><span class="math display">\[
\lambda_{ICvEC}^{new} ~ \sim N ( \mu , \sigma^2).
\]</span> Combining posterior draws of <span class="math inline">\(\lambda_{TRTvEC}^{new}\)</span> and <span class="math inline">\(\lambda_{ICvEC}^{new}\)</span>, we obtain samples of our quantity of interest,</p>
<p><span class="math display">\[
\lambda_{TRTvIC}^{new} = \lambda_{TRTvEC}^{new} - \lambda_{ICvEC}^{new}.
\]</span></p>
</div>
</div>
<div id="appendix" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h1>
<div id="dags" class="section level2">
<h2 class="hasAnchor">
<a href="#dags" class="anchor"></a>Model as a DAG</h2>
<p>We can visualise a model with treatment, internal control, and external control arms as a directed acyclic graph (DAG). In the figure below, the nodes with a suffix TRUE represent the outcomes within a population and the nodes with a suffix OBS represent the observed outcomes in the study. The lighter coloured nodes are those which are not observed, the darker coloured nodes are observed and the darkest nodes in the outcomes for the treatment and the internal controls in the test are what we are ultimately interested in. <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> describe the level of similarity between the outcomes in the internal and external control arms.</p>
<p><img src="dag1.jpeg"></p>
<p>It is clear that the true and observed treatment outcome for the reference studies plays no part in these calculations and so can be discarded. We can therefore reformulate our problem as an alternative DAG expressed in terms of the observed hazard ratios.</p>
<p><img src="dag2.jpeg"></p>
</div>
<div id="ml" class="section level2">
<h2 class="hasAnchor">
<a href="#ml" class="anchor"></a>Maximum likelihood approach</h2>
<div id="estimation-1" class="section level3">
<h3 class="hasAnchor">
<a href="#estimation-1" class="anchor"></a>Estimation</h3>
<p><span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> can be estimated by maximizing the log-likelihood function. In particular, given a set of reference studies indexed by <span class="math inline">\(j\)</span>, estimated log HRs between the internal and external controls, <span class="math inline">\(\hat\lambda_{ICvEC,j}\)</span>, and estimated standard errors <span class="math inline">\(V_j\)</span>, it is not hard to show that we can estimate <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> by optimization of the log-likelihood function,</p>
<p><span class="math display">\[
\text{log } l(\mu,\sigma) = 0.5 \times \sum{log(\sigma^2+V_j)} +
0.5 \times \sum{ \frac{(\hat\lambda_j-\mu)^2}{(\sigma^2+V_j)} }.
\]</span></p>
</div>
<div id="prediction-for-new-study-1" class="section level3">
<h3 class="hasAnchor">
<a href="#prediction-for-new-study-1" class="anchor"></a>Prediction for new study</h3>
<p>We note (see <a href="http://www.stat.columbia.edu/~gelman/book/BDA3.pdf">Gelman et al. 2020, p. 66</a>) that the posterior predictive distribution for a new observation <span class="math inline">\(y^{new}\)</span> follows a t distribution with location <span class="math inline">\(\overline{y}\)</span>, scale <span class="math inline">\(s\sqrt{(1 + 1/n)}\)</span>, and <span class="math inline">\(n-1\)</span> degrees of freedom where <span class="math inline">\(\overline{y}\)</span> is the mean and <span class="math inline">\(s^2=1/(n-1)\sum (y_i - \overline{y})^2\)</span> is the variance from the <span class="math inline">\(n\)</span> observations. In our setting it follows that <span class="math inline">\(\lambda_{ICvEC}^{new}\)</span> follows a t distribution with mean <span class="math inline">\(\hat{\mu}\)</span> and scale <span class="math inline">\(\hat{\sigma}\sqrt{(1 + 1/n)}\)</span>.</p>
<p>A simulation procedure for obtaining draws of <span class="math inline">\(\lambda_{TRTvIC}^{new}\)</span> then proceeds as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Draw <span class="math inline">\(\lambda_{TRTvEC}^{new} \sim N(\hat{\lambda}_{TRTvEC}^{new}, V^{new})\)</span></p></li>
<li><p>Draw <span class="math inline">\(\lambda_{ICvEC}^{new} \sim t_{n-1}(\hat{\mu}, \hat{\sigma}\sqrt{(1 + 1/n)})\)</span> where <span class="math inline">\(t_v(a, b)\)</span> is a student t distribution with <span class="math inline">\(v\)</span> degrees of freedom, location <span class="math inline">\(a\)</span>, and scale <span class="math inline">\(b\)</span></p></li>
<li><p>Use the draws from 1 and 2 to compute <span class="math inline">\(\lambda_{TRTvIC}^{new} = \lambda_{TRTvEC}^{new} - \lambda_{ICvEC}^{new}\)</span></p></li>
</ol>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Michael Bretscher, Ray Lin, Chris Harbron.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
